<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pakistan Railways – Current Train Status</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    pre { background: #f4f4f4; padding: 15px; border-radius: 5px; }
    input { width: 50px; margin-right: 10px; }
    button { padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>

<h3>Pakistan Railways – Current Train Status</h3>

<label for="trainId">Train ID:</label>
<input type="text" id="trainId" value="27">
<button id="getStatus">Get Current Status</button>

<pre id="output">Loading current status…</pre>

<script>
const output = document.getElementById("output");

document.getElementById("getStatus").addEventListener("click", async () => {
  const TRAIN_ID = document.getElementById("trainId").value.trim();
  if (!TRAIN_ID) return alert("Please enter a Train ID");

  output.textContent = "Fetching current status…";

  try {
    const res = await fetch(`https://app-api.pakraillive.com/api/Train/GetTrainById?id=${TRAIN_ID}`);
    if (!res.ok) throw new Error("API request failed");

    const json = await res.json();
    if (!json) throw new Error("No data received");

    const result = {
      trainId: json.TrainId,
      trainName: json.TrainName || `Train ${TRAIN_ID}`,
      delayMinutes: json.delay,
      speedKmh: json.speed,
      lastUpdate: new Date(json.lastUpdate * 1000).toLocaleString(),
      nextStation: json.nextStation || "N/A",
      lastStation: json.prevStation || "N/A",
      latitude: json.latitude || 0,
      longitude: json.longitude || 0,
      status: json.IsLive ? "RUNNING" : "STOPPED",
      estimatedArrival: json.eta || "N/A"
    };

    output.textContent = JSON.stringify(result, null, 2);

  } catch (err) {
    console.error(err);
    output.textContent = "Failed to fetch current status.";
  }
});
</script>

</body>
</html>
