<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbya7KRQupcY_anV146gjtN0EeH6hQakjh20emQsgJqY0seA8MRV0vqst3zyE4zL2t6b/exec";

// Fetch complaints JSON
async function fetchComplaints() {
  const res = await fetch(`${WEB_APP_URL}?page=getComplaints`);
  return await res.json();
}

// Render complaints table
function renderTable(complaints) {
  const tbody = document.querySelector("#complaintTable tbody");
  tbody.innerHTML = "";

  const filter = document.getElementById("statusFilter").value;
  const filtered = filter === "ALL" ? complaints : complaints.filter(c => c.STATUS === filter);

  filtered.forEach((c, i) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${new Date(c.DATE).toLocaleString()}</td>
      <td>${c.COMPLAINANT}</td>
      <td>${c.CONTACT}</td>
      <td>${c.TYPE}</td>
      <td>${c.MESSAGE}</td>
      <td>${c.PICS ? `<a href="${c.PICS}" target="_blank">View</a>` : ""}</td>
      <td>${c.STATUS}</td>
      <td>${c.REMARKS}</td>
    `;
    tbody.appendChild(tr);
  });
}

// Filter change
document.getElementById("statusFilter").addEventListener("change", async () => {
  const complaints = await fetchComplaints();
  renderTable(complaints);
});

// Initial load
fetchComplaints().then(renderTable);
</script>
