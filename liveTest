<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pakistan Railways Live Train Status</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin:0; padding:0; }
    table { width: 95%; margin:20px auto; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #2e7d32; color: #fff; }
    tr:nth-child(even) { background: #f2f2f2; }
  </style>
</head>
<body>

<h1 style="text-align:center; color:#2e7d32;">Pakistan Railways Live Train Status</h1>

<table id="statusTable">
  <thead>
    <tr>
      <th>Train ID</th>
      <th>Train Name</th>
      <th>Previous Station</th>
      <th>Current Location</th>
      <th>Next Station</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="6">Waiting for live data...</td></tr>
  </tbody>
</table>

<!-- Include Socket.IO -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>
  // ID of train you want to track
  const TRAIN_ID = 41;

  // Connect to PakRail Socket.IO server
  const socket = io("https://cotrolroomapi.pakraillive.com", {
    path: "/socket.io",
    transports: ["websocket", "polling"]
  });

  socket.on("connect", () => {
    console.log("Connected to PakRail Socket.IO server! Socket ID:", socket.id);

    // Ask server for live updates for this train
    socket.emit("subscribeTrain", { trainId: TRAIN_ID });
  });

  // Listen for live train updates
  socket.on("trainUpdate", (data) => {
    console.log("Live update received:", data);

    const tbody = document.querySelector("#statusTable tbody");
    tbody.innerHTML = ""; // clear old row

    const currentStation = data.nextStation?.StationName || "En Route";
    const lastStation = data.lastStation?.StationName || "N/A";

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${TRAIN_ID}</td>
      <td>${data.trainName || "N/A"}</td>
      <td>${lastStation}</td>
      <td>${currentStation}</td>
      <td>${data.nextStation?.StationName || "N/A"}</td>
      <td>${data.status || "N/A"}</td>
    `;
    tbody.appendChild(row);
  });

  socket.on("connect_error", (err) => {
    console.error("Socket connection error:", err);
  });
</script>

</body>
</html>
