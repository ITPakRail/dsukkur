<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Train Timing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Choices.js CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">

<style>
body { font-family: Arial; margin:0; background:#f2f2f2; }

header {
  background: green;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 22px;
}

.panel {
  background: navy;
  padding: 15px;
  color: white;
  text-align: center;
}

button {
  padding: 8px;
  width: 90%;
  max-width: 400px;
  margin: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

th {
  background: #333;
  color: white;
}

#trainTitle {
  margin-top: 15px;
  font-weight: bold;
  text-align: center;
}

/* Choices.js dropdown overrides */
.choices__inner {
  background-color: white !important;
  color: black !important;
  border-radius: 4px;
  border: 1px solid #ccc;
  padding: 5px 10px;
  min-height: 40px;
}

.choices__list--single .choices__item {
  color: black !important;
}

.choices__list--dropdown {
  max-height: 200px;
  overflow-y: auto;
}

.choices__input {
  color: black !important;
}
</style>
</head>

<body>

<header>Train Timing</header>

<div class="panel">
  <select id="trainSelect"></select><br>
  <button onclick="loadTiming()">Search</button>
</div>

<div id="trainTitle"></div>

<table id="resultTable" style="display:none">
  <thead>
    <tr>
      <th>Station</th>
      <th>Arrival</th>
      <th>Departure</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Choices.js JS -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
const API = "YOUR_WEB_APP_URL_HERE"; // Replace with your GAS web app URL
const sel = document.getElementById("trainSelect");

// ðŸ”¹ Load dropdown
fetch(API + "?action=trains")
  .then(r => r.json())
  .then(data => {
    sel.innerHTML = `<option value="">Search Train...</option>`;
    data.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = `${t.id} - ${t.name}`;
      sel.appendChild(opt);
    });

    // Initialize Choices.js after options loaded
    const choices = new Choices(sel, {
      searchEnabled: true,
      itemSelectText: '',
      placeholderValue: "Search Train...",
      shouldSort: false,
      position: 'bottom'
    });

    // Match width of dropdown to button
    document.querySelector('.choices').style.width = document.querySelector('button').offsetWidth + 'px';
  });

// ðŸ”¹ Load timing
function loadTiming() {
  const trainId = sel.value;
  if (!trainId) return alert("Select a train");

  fetch(API + "?action=timing&trainid=" + trainId)
    .then(r => r.json())
    .then(rows => {
      document.getElementById("resultTable").style.display = "table";
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";

      document.getElementById("trainTitle").innerText =
        sel.selectedOptions[0].text;

      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.station}</td>
          <td>${r.arrival}</td>
          <td>${r.departure}</td>
        `;
        tbody.appendChild(tr);
      });
    });
}
</script>

</body>
</html>
