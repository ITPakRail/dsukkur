<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Train Timing</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Choices.js CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<style>
body { font-family: Arial; margin:0; background:#f2f2f2; }

header {
  background: green;
  color: white;
  padding: 15px;
  text-align: center;
  font-size: 22px;
}

.panel {
  background: navy;
  padding: 15px;
  color: white;
  text-align: center;
}

select, button {
  padding: 8px;
  width: 90%;
  max-width: 400px;
  margin: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin-top: 15px;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: left;
}

th {
  background: #333;
  color: white;
}

#trainTitle {
  margin-top: 15px;
  font-weight: bold;
  text-align: center;
}
</style>
</head>

<body>

<header>Train Timing</header>

<div class="panel">
  <select id="trainSelect"></select><br>
  <button onclick="loadTiming()">Search</button>
</div>

<div id="trainTitle"></div>

<table id="resultTable" style="display:none">
  <thead>
    <tr>
      <th>Station</th>
      <th>Arrival</th>
      <th>Departure</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Choices.js Script -->
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbya7KRQupcY_anV146gjtN0EeH6hQakjh20emQsgJqY0seA8MRV0vqst3zyE4zL2t6b/exec";

/* ðŸ”¹ Load dropdown with searchable select */
fetch(API + "?action=trains")
  .then(r => r.json())
  .then(data => {
    const sel = document.getElementById("trainSelect");
    sel.innerHTML = `<option value="">Search Train...</option>`;
    data.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = `${t.id} - ${t.name}`;
      sel.appendChild(opt);
    });

    // Initialize Choices.js for search functionality
    new Choices(sel, {
      searchEnabled: true,
      itemSelectText: '',
      placeholderValue: "Search Train..."
    });
  })
  .catch(err => console.error("Failed to load train list:", err));

/* ðŸ”¹ Load timing on button click */
function loadTiming() {
  const trainId = document.getElementById("trainSelect").value;
  if (!trainId) return alert("Select a train");

  fetch(API + "?action=timing&trainid=" + trainId)
    .then(r => r.json())
    .then(rows => {
      document.getElementById("resultTable").style.display = "table";
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";

      document.getElementById("trainTitle").innerText =
        document.getElementById("trainSelect").selectedOptions[0].text;

      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.station}</td>
          <td>${r.arrival}</td>
          <td>${r.departure}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      console.error("Failed to load timing:", err);
      alert("Failed to fetch train timing.");
    });
}
</script>

</body>
</html>
